# スマホ対応・外で使うまでの作業手順

夫婦でスマホから更新・確認し、外でも使えるようにするための手順です。

> **用語に自信がない方・初めての方**は、同じフォルダの **「かんたん手順_スマホで使うまで.md」** を開いてください。小学生でもわかるように、少しずつ説明しています。

---

## 全体の流れ

| Phase | 内容 | 状態 |
|-------|------|------|
| **Phase 1** | スマホレイアウトの調整 | ✅ 実装済み（1-1 〜 1-4） |
| **Phase 2** | 外でも夫婦で更新・確認できるようにする | 手順のみ（実施は任意） |
| **Phase 3** | AI診断をスマホで問題なく動かす | 一部反映済み（3-1 〜 3-3） |

---

## Phase 1: スマホレイアウトの調整

**目的**: スマホでメインに使うとき、操作しやすく・読みやすくする。

### 1-1. スマホではナビを下部固定（ボトムナビ）にする
- 現状: 画面幅が狭いときは上部にアイコンのみのナビが並んでいる。
- 作業: スマホ（例: 768px 未満）のときは **ナビを画面下部に固定** し、アイコン＋短いラベルで表示する。親指で届きやすくする。
- 結果: メインエリアはナビの高さ分だけ下に余白（`padding-bottom`）を入れる。

### 1-2. タッチしやすいサイズ・余白にする
- ボタンやタブのタップ領域を **最低 44px 程度** にし、間隔をあける。
- フォームの入力欄や「診断を開始」などの主要ボタンが、スマホで押しやすいようにする。

### 1-3. ダッシュボード・グラフのスマホ表示
- ダッシュボードのカードが 2 列で崩れないようにする。
- 資産推移・資産構成のグラフが横スクロールや縮小で見えるようにする。

### 1-4. 設定・FP診断・収支タブのスマホ表示
- 設定画面や FP 診断のフォームが、画面幅からはみ出さないようにする。
- 長いテキスト（AI 診断結果など）は折り返し・スクロールで読めるようにする。

**Phase 1 で実施したこと**: スマホ時にボトムナビ（ホーム・収支・AI・目的・FP・設定）に変更、メイン余白・ヘッダー・AI/設定のパディング調整、診断結果のテキスト選択可能化、月送りボタンのタッチ領域拡大。

---

## Phase 2: 外でも夫婦で更新・確認できるようにする

**目的**: 妻（iOS）・夫（Android）が、外出先のスマホから同じ家計データを更新・確認できるようにする。

### 2-1. アプリを公開 URL にデプロイする
- このアプリは **ブラウザで開く Web アプリ** のため、どこか 1 つの URL にデプロイする必要があります。
- 例:
  - **Vercel**: GitHub と連携して `main` を push するだけでデプロイ可能。
  - **Netlify**: 同様に GitHub 連携でデプロイ可能。
- 作業: デプロイ後、**共有用の URL**（例: `https://your-app.vercel.app`）を用意する。

### 2-2. クラウド同期（Supabase）の設定
- アプリには「クラウド同期」があり、**Supabase** にデータを保存すると、同じ「世帯 ID」で開いた別の端末とデータが共有されます。
- 手順（要約）:
  1. [Supabase](https://supabase.com) でプロジェクトを作成する。
  2. テーブル `household_sync`（またはアプリが参照している名前）を用意する（README やコードの `storageService` を参照）。
  3. アプリの **設定** で「Supabase URL」「API Key」「世帯 ID」を **夫婦同じ値** で入力し、同期を ON にする。
  4. 妻の iPhone（Safari）と夫の Android（Chrome）の **両方** で、同じデプロイ URL を開き、上記と同じ設定にすると、データが共有されます。

### 2-3. iOS（Safari）・Android（Chrome）での確認
- デプロイ URL を、実機の **Safari（iOS）** と **Chrome（Android）** で開いて確認する。
- 画面の崩れ・スクロール・入力・保存・同期が問題ないか確認する。
- 問題があれば Phase 1 のレイアウトやフォントサイズを微調整する。

### 2-4. （任意）PWA でホーム画面に追加
- すでに `index.html` に PWA 用の meta や `manifest.json` の参照があります。
- デプロイ後、スマホのブラウザで「ホーム画面に追加」すると、アプリのように起動できます。
- iOS と Android の両方で「ホーム画面に追加」できることを確認する。

---

## Phase 3: AI 診断をスマホで問題なく動かす

**目的**: AI 資産分析・FP 診断がスマホでも快適に使えるようにする。

### 3-1. 診断中の表示（ローディング）
- 「診断中...」「Analyzing Portfolio...」などの表示が、スマホの画面中央で見やすく、長い診断でも待ちやすいようにする。
- 必要ならスピナーやメッセージのサイズを少し大きくする。

### 3-2. 診断結果の表示
- 診断結果のテキストが **折り返し** され、縦に **スクロール** して最後まで読めるようにする。
- テキストをコピーしたい場合に備え、結果エリアは **選択可能**（`user-select: text`）にしておく。

### 3-3. API キー入力・エラー表示
- 設定タブの「Gemini API キー」入力欄が、スマホのキーボードで入力しやすいようにする。
- API エラー時のメッセージが、スマホの画面幅ではみ出さず、読めるようにする。
- ※ API キーは **端末ごと**（ブラウザの localStorage）に保存されます。妻の iPhone と夫の Android でそれぞれ 1 回ずつ設定が必要です。

---

## 作業の進め方（おすすめ順）

1. **Phase 1** をすべて実施する（スマホで一度操作確認）。
2. **Phase 2-1** でデプロイし、**Phase 2-2** で Supabase を設定して、二人で同じ URL を開いて同期を確認する。
3. **Phase 2-3** で実機（iOS・Android）の動作確認をする。
4. **Phase 3** で AI 診断まわりをスマホ向けに整える。
5. 必要に応じて **Phase 2-4**（PWA・ホーム画面追加）を行う。

---

## 補足

- **Gemini API キー**: 各端末のブラウザに保存されるため、妻・夫それぞれのスマホで 1 回ずつ「設定」から入力する必要があります。クラウドには送られません。
- **オフライン**: 現在はオンライン前提です。オフライン時の挙動は Phase 2 以降で必要に応じて検討できます。
- **セキュリティ**: Supabase の API Key は「anon」ではなく、必要なら RLS や専用キーで制限することを推奨します。詳細は Supabase のドキュメントを参照してください。
