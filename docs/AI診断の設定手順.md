# AI診断をできるようにする — 進め方

家計簿アプリの **AI資産分析** と **FP診断** を使うには、**Gemini APIキー** を1回だけ設定します。  
使う **端末ごと**（スマホ・PCそれぞれ）に1回ずつ設定が必要です。

---

## 手順の流れ（3ステップ）

| 番号 | やること | できたら |
|------|----------|----------|
| 1 | Google AI Studio で API キーを発行する | キー（長い英数字）がコピーできる |
| 2 | 家計簿アプリの「設定」でキーを入れて保存する | 「保存しました」と出る |
| 3 | 「AI資産分析」または「FP診断」タブで診断を実行する | 結果が表示される |

---

## ステップ1：Gemini API キーを発行する

1. ブラウザで **https://aistudio.google.com** を開く。
2. **Google アカウント** でログインする。
3. 左メニューや画面から **「Get API key」** または **「API キーを取得」** を選ぶ。
4. **「Create API key」**（API キーを作成）を押す。  
   - プロジェクトを聞かれたら、既存のものを選ぶか「新しいプロジェクト」で作成。
5. 表示された **長い英数字のキー** を **コピー** する。  
   - このキーはあとで再表示できない場合があるので、メモ帳に貼り付けておいてもよい。

※ 無料枠で利用できます（Google AI Studio の制限に従います）。

---

## AI診断の回数制限について

**制限は「アプリ」ではなく、Google の Gemini API 側にかかります。**

- **無料枠**には、**1分あたり・1日あたりのリクエスト数**の制限があります。
- **夫婦で家計の診断を数回〜十数回／日**程度なら、無料枠内で収まることが多いです。
- 制限に達すると、しばらく時間をおくか、翌日になればまた利用できます。  
- **最新の制限値**は変更されることがあるので、気になる場合は **Google AI Studio** または **Gemini API の割り当てと上限**（検索すると公式ドキュメントが出ます）で確認してください。
- 有料プランにすると制限が緩和されますが、まずは無料のまま使って問題ないか試してからで大丈夫です。

---

## 制限がかかったときの対策：データとプロンプトをテキストで出力

API制限で診断ができないときでも、**同じ内容を Gemini や ChatGPT のブラウザ版に貼り付けて**使えるようにする機能があります。

1. **AI資産分析**の画面で **「制限時用：データとプロンプトをテキストで出力」** ボタンを押す。  
   または **FP診断**の画面で同じ名前のボタンを押す。
2. テキストファイル（.txt）がダウンロードされます。  
   中身は「このデータとプロンプトを Gemini / ChatGPT に貼り付けてください」という説明＋診断用のデータと質問文（プロンプト）です。
3. ブラウザで **Gemini**（aistudio.google.com）や **ChatGPT**（chat.openai.com）を開き、**ダウンロードしたファイルを開いて全文をコピー**し、**入力欄に貼り付けて送信**すると、APIを使わずに診断結果を得られます。

これで制限中でも、手動で貼り付けるだけで同じ診断が可能です。

---

## ステップ2：家計簿アプリの「設定」でキーを保存する

1. **家計簿アプリ**（Vercel の URL）を開く。
2. 下のナビ（または左サイドバー）の **「設定」** を開く。
3. **「AI 設定（資産分析・FP診断）」** のブロックまで下にスクロールする。
4. **「AIプロバイダー」** は **「Google Gemini（利用可能）」** のままにする。
5. **「Gemini APIキー」** の欄に、ステップ1でコピーしたキーを **貼り付ける**。
6. **「モデル」** はそのまま（例：`gemini-2.0-flash`）でよい。
7. **「保存」** ボタンを押す。
8. **「保存しました。AI資産分析で「診断を開始」を押してください。」** と出ればOK。

**ポイント**

- このキーは **その端末のブラウザにだけ** 保存されます。クラウド同期されないので、**スマホとPCの両方で使う場合は、それぞれの端末で1回ずつ** 同じ手順（ステップ2）を行う必要があります。
- キーは他人に見られないようにしてください。

---

## ステップ3：AI診断を使う

### AI資産分析

1. 家計簿アプリで **「AI資産分析」** タブを開く。
2. **「最新データで診断を開始」** を押す。
3. しばらく待つと、収支・資産に基づいたアドバイスが表示される。

### FP診断

1. **「FP診断」** タブを開く。
2. フォームに必要項目（世帯形態・年収・貯蓄の目標など）を入力する。
3. **「診断を開始」** を押す。
4. 追加の質問が出たら答える。
5. 診断結果が表示される。

---

## うまくいかないとき

- **「Gemini APIキーが未設定です」と出る**  
  → 設定タブで **「Gemini APIキー」を入力して「保存」** を押したか確認する。保存後、もう一度「診断を開始」を試す。

- **「利用上限（クォータ）に達しました」「約○秒後に再試行できます」と出る**  
  → **短時間に何度も診断した** ときは、表示どおり数十秒〜1分待ってからもう一度試してください。  
  → **指定された時間をあけても同じエラーになる場合**は、**本日の利用上限（日次クォータ）に達している**可能性があります。そのときは **1時間以上あけてから** か、**翌日** あらためて試してください。無料枠は日付が変わるとリセットされます。  
  → 利用状況を確認したい場合は、**Google AI Studio**（aistudio.google.com）にログインし、API キーの利用量・クォータの画面を確認できます。

- **エラーや「無効なキー」と出る**  
  → API キーをコピーしたときに **前後にスペースや改行が入っていないか** 確認する。もう一度 AI Studio でキーを発行し直し、設定で貼り直して保存する。

- **スマホで設定したが、PCでは使えない**  
  → キーは端末ごとに保存されるため、**PCでも設定タブで同じキーを入れて「保存」** する必要がある。

---

## まとめ

1. **aistudio.google.com** で API キーを発行してコピー  
2. 家計簿アプリの **設定** → **Gemini APIキー** に貼り付けて **保存**  
3. **AI資産分析** または **FP診断** で診断を実行  

使う端末（スマホ・PC）ごとに、ステップ2を1回ずつ行えば、どの端末からでもAI診断が使えます。
